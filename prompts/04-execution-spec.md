# üìÑ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –¢–ó (Execution-Spec)

> –®–∞–±–ª–æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∫–æ–Ω–≤–µ–π–µ—Ä–∞: **high‚Äëreasoning –º–æ–¥–µ–ª—å ‚Üí —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è ‚Üí Codex / low‚Äëreasoning –º–æ–¥–µ–ª—å ‚Üí —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**

–î–æ–∫—É–º–µ–Ω—Ç –ø–∏—à–µ—Ç—Å—è thinking‚Äë–º–æ–¥–µ–ª—å—é –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º *–±–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π*.

---

## 0. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
–î–∞–Ω–Ω—ã–π Execution-Spec —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —ç—Ç–∞–ø–∞ Solution Space Exploration (–±–ª–æ–∫ `=== RESULT FOR EXECUTION-SPEC ===` –≤ —Ñ–∞–π–ª–µ `03-solution-hld.md`) –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–æ–∫—É–º–µ–Ω—Ç `05-user-cabinet-structure.md`).

–í—Ö–æ–¥–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
- –í–∞—Ä–∏–∞–Ω—Ç 2: FastAPI, REST API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, SSE –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ LLM; –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å (tenant_id, user_id); –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env; –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞; –¥–∏–∞–ª–æ–≥–∏ –≤ PostgreSQL.
- –ö–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (–í–∞—Ä–∏–∞–Ω—Ç B): —Ä–∞–∑–¥–µ–ª—ã ¬´–ú–æ–∏ –¥–∏–∞–ª–æ–≥–∏¬ª, ¬´–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ¬ª, ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª; –º–∞—Ä—à—Ä—É—Ç—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ–Ω–∞–Ω—Ç–∞: `/{tenant_slug}/my`, `/{tenant_slug}/my/dialogs`, `/{tenant_slug}/my/saved`, `/{tenant_slug}/my/profile`.

**–¶–µ–ª—å:**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¥–∞–Ω–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º.

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- –ª—é–±—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π;
- —É–ª—É—á—à–µ–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ ¬´–ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é¬ª;
- –ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã;
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–æ–ø–∏—Å–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

**–†–æ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:**
- —Å—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã;
- –µ—Å–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –Ω–µ –æ–ø–∏—Å–∞–Ω–æ ‚Äî —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –µ–≥–æ –Ω–µ—Ç;
- –ø—Ä–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏ ‚Äî –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, –∞ –Ω–µ —É–≥–∞–¥—ã–≤–∞—Ç—å.

---

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1.1 –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–∏—Å—Ç–µ–º—ã

- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: Backend –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –≤–µ–±-—Å–∞–π—Ç–∞ —Å AI-–∞–≥–µ–Ω—Ç–æ–º (CIP). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ REST API; –æ—Ç–≤–µ—Ç LLM —Å—Ç—Ä–∏–º–∏—Ç—Å—è –ø–æ SSE. –î–∏–∞–ª–æ–≥–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ tenant_id –∏ user_id –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å; –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ API –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ–Ω–∞–Ω—Ç–∞.
- –Ø–∑—ã–∫ / –≤–µ—Ä—Å–∏—è: Python 3.11+ (–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –≤–µ—Ä—Å–∏—è, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ –ø—Ä–æ–µ–∫—Ç–µ).
- –°—Ç–µ–∫ / —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏: FastAPI, PostgreSQL (–¥—Ä–∞–π–≤–µ—Ä async –∏–ª–∏ sync ‚Äî –Ω–∞ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏), Docker, docker-compose. LLM ‚Äî DeepSeek (HTTP API).
- –¢–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: Backend-—Å–µ—Ä–≤–∏—Å (REST API + SSE + —Ä–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏–∫–∏ –¥–ª—è —á–∞—Ç–∞ –≤ iframe –∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
- –ú–æ–¥—É–ª—å / –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞: –ß–∞—Ç-—Å–µ—Ä–≤–∏—Å (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —Å—Ç—Ä–∏–º–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞, –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Å –¥–∏–∞–ª–æ–≥–æ–≤); –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ, –ø—Ä–æ—Ñ–∏–ª—å).
- –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: HTTP-–∫–ª–∏–µ–Ω—Ç –∫ LLM DeepSeek (URL –∏–∑ .env); –∫–ª–∏–µ–Ω—Ç —á–∞—Ç–∞ –≤ iframe –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ REST –∏ SSE.

### 1.2 –ñ—ë—Å—Ç–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (Hard constraints)

- –Ø–∑—ã–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî —Ç–æ–ª—å–∫–æ Python. –°—Ç–µ–∫ ‚Äî —Ç–æ–ª—å–∫–æ FastAPI, PostgreSQL, Docker/docker-compose.
- –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∑–∞–¥–∞–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ñ–∞–π–ª–µ .env; –∑–∞–ø—Ä–µ—â–µ–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤–Ω–µ .env.
- –ü—Ä–æ–º–ø—Ç LLM –∑–∞–ø—Ä–µ—â–µ–Ω–æ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –≤ –∫–æ–¥–µ; –ø—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω —á–∏—Ç–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞, –ø—É—Ç—å/–∏–º—è –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (.env –∏–ª–∏ –∞–Ω–∞–ª–æ–≥).
- URL LLM-—Å–µ—Ä–≤–µ—Ä–∞ (DeepSeek) –¥–æ–ª–∂–µ–Ω –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤ .env).
- –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –æ–¥–Ω–æ–º—É –≤—ã–∑–æ–≤—É LLM –∏ –æ–¥–Ω–æ–º—É SSE-–ø–æ—Ç–æ–∫—É.
- –í—Å–µ API-–∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–ª–∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—Ç—å tenant_id (–∑–∞–≥–æ–ª–æ–≤–æ–∫, –ø—É—Ç—å –∏–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω ‚Äî –µ–¥–∏–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏).
- –í –ë–î –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –¥–∏–∞–ª–æ–≥–∞–º –∏ –∫–∞–±–∏–Ω–µ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ tenant_id –∏ user_id; –∏–∑–æ–ª—è—Ü–∏—è –ø–æ —Ç–µ–Ω–∞–Ω—Ç—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞.

> –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏.

---

## 2. –¢–µ—Ä–º–∏–Ω—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

| –¢–µ—Ä–º–∏–Ω | –ó–Ω–∞—á–µ–Ω–∏–µ |
| ------ | -------- |
| TENANT_ID | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–Ω–∞–Ω—Ç–∞ (–≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏–Ω—Å—Ç–∞–Ω—Å–∞ CIP); –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ tenant_id. |
| USER_ID | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è —Å–∞–π—Ç–∞ —Ç–µ–Ω–∞–Ω—Ç–∞) –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–Ω–∞–Ω—Ç–∞; –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–∞–Ω–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ tenant_id –∏ user_id. |
| –î–ò–ê–õ–û–ì | –ù–∞–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏—Ö –æ–¥–Ω–æ–º—É tenant_id –∏ –æ–¥–Ω–æ–º—É user_id; –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è dialog_id (–∏–ª–∏ session_id). |
| –°–ï–°–°–ò–Ø | –°–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–Ω–∞–Ω—Ç–∞; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è user_id (–∞–Ω–æ–Ω–∏–º–Ω—ã–π –∏–ª–∏ –ø–æ—Å–ª–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏); –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ cookie –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–µ. |
| –ö–ê–ë–ò–ù–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø | –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è: —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ, –ø—Ä–æ—Ñ–∏–ª—å; –¥–æ—Å—Ç—É–ø –ø–æ API –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ–Ω–∞–Ω—Ç–∞. |
| –°–û–•–†–ê–ù–Å–ù–ù–û–ï | –≠–ª–µ–º–µ–Ω—Ç—ã (—Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ), —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–∑ —á–∞—Ç–∞; —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ tenant_id –∏ user_id. |
| LLM | Large Language Model; –≤ –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ ‚Äî DeepSeek, –≤—ã–∑—ã–≤–∞–µ–º—ã–π –ø–æ HTTP API. |
| SSE | Server-Sent Events; –ø—Ä–æ—Ç–æ–∫–æ–ª –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É (—Å—Ç—Ä–∏–º —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–≤–µ—Ç–∞ LLM). |
| –ü–†–û–ú–ü–¢ | –¢–µ–∫—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ/–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è LLM; —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–ª–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É; –ø—É—Ç—å –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–µ–Ω–∞–Ω—Ç–∞). |

–ï—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –∑–¥–µ—Å—å, –æ–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

## 3. –¢—Ä–µ–±—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (Behavior specification)

### 3.1 –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π (—á–∞—Ç)

1. –ö–ª–∏–µ–Ω—Ç (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ iframe –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π –∫–ª–∏–µ–Ω—Ç) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST-–∑–∞–ø—Ä–æ—Å —Å —Ç–µ–ª–æ–º: tenant_id, user_id, —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ dialog_id (–∏–ª–∏ session_id) –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞.
2. –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ tenant_id –∏ user_id, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–π –ø–∞—Ä—ã (tenant_id, user_id) –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ dialog_id –∏–∑ PostgreSQL.
3. –°–µ—Ä–≤–µ—Ä —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ LLM DeepSeek (—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ + –∏—Å—Ç–æ—Ä–∏—è + –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ), –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ LLM —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç—Ä–∏–º–∏–Ω–≥–∞.
4. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å Content-Type –¥–ª—è SSE –∏ –ø–æ—Ç–æ–∫–æ–≤–æ –ø–µ—Ä–µ–¥–∞—ë—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç LLM —Ç–æ–∫–µ–Ω—ã –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞ (—Ñ–æ—Ä–º–∞—Ç SSE).
5. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ç—Ä–∏–º–∞ —Å–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ PostgreSQL —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ tenant_id, user_id –∏ dialog_id (–∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥).
6. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (HTML/JS) –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è —á–∞—Ç–∞ –≤ iframe: —Ñ–æ—Ä–º–∞ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø—Ä–∏—ë–º SSE —Å –ø–æ—à–∞–≥–æ–≤—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å tenant_id –∏ user_id (user_id –º–æ–∂–µ—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ cookie/—Å–µ—Å—Å–∏–∏, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ).

### 3.2 –°—Ü–µ–Ω–∞—Ä–∏–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. **–°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤.** –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç GET-–∑–∞–ø—Ä–æ—Å –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤ —Å tenant_id –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (user_id –∏–∑ —Å–µ—Å—Å–∏–∏/cookie –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞). –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ (id, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–≤—ã–µ N —Å–∏–º–≤–æ–ª–æ–≤ ‚Äî –Ω–∞ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ —Ñ–æ—Ä–º–∞—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω) –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ tenant_id –∏ user_id, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É). –ü–∞–≥–∏–Ω–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ (limit, offset –∏–ª–∏ cursor).
2. **–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–¥–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞.** –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç GET-–∑–∞–ø—Ä–æ—Å –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É –¥–∏–∞–ª–æ–≥–∞ —Å tenant_id, user_id –∏ dialog_id. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–∏–∞–ª–æ–≥ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥–∞–Ω–Ω–æ–π –ø–∞—Ä–µ (tenant_id, user_id), –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∏–∞–ª–æ–≥–∞ (—Ä–æ–ª—å, —Ç–µ–∫—Å—Ç, –≤—Ä–µ–º—è). –ï—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî –æ—Ç–≤–µ—Ç 404.
3. **–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ.** –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç GET —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤; POST ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç (—Ç–∏–ø –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞/—Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–µ–ª–µ); DELETE ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ id. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö tenant_id –∏ user_id. –§–æ—Ä–º–∞—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ: id, type (–Ω–∞–ø—Ä–∏–º–µ—Ä, message –∏–ª–∏ content), reference_id (id —Å–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞), —Å–æ–∑–¥–∞–Ω_at ‚Äî –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ –≤ API.
4. **–ü—Ä–æ—Ñ–∏–ª—å.** GET ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (user_id, tenant_id, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è, –∫–æ–Ω—Ç–∞–∫—Ç ‚Äî –µ—Å–ª–∏ –µ—Å—Ç—å). PATCH ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ –∏–º–µ–Ω–∏ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ (–µ—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞). –ü—Ä–æ—Ñ–∏–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î –ø–æ tenant_id –∏ user_id; –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–ø–∏—Å–∏ GET –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

### 3.3 –ú–∞—Ä—à—Ä—É—Ç—ã —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- –†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–∏–ª–∏ SPA) –¥–ª—è –ø—É—Ç–µ–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ–Ω–∞–Ω—Ç–∞: `/{tenant_slug}/my`, `/{tenant_slug}/my/dialogs`, `/{tenant_slug}/my/saved`, `/{tenant_slug}/my/profile`. tenant_slug –¥–æ–ª–∂–µ–Ω –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ —Ä–µ–∑–æ–ª–≤–∏—Ç—å—Å—è –≤ tenant_id (—Ç–∞–±–ª–∏—Ü–∞ tenant –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è); –µ—Å–ª–∏ —Ç–µ–Ω–∞–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –æ—Ç–≤–µ—Ç 404. –°—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∑–≤–æ–ª—è—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤, –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–ª–æ–≥–∞, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ –∏ –ø—Ä–æ—Ñ–∏–ª—å, –∏—Å–ø–æ–ª—å–∑—É—è API –≤—ã—à–µ; user_id –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è cookie/—Å–µ—Å—Å–∏–µ–π (–∞–Ω–æ–Ω–∏–º–Ω—ã–π id –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ –∏–ª–∏ –ø–æ—Å–ª–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚Äî –≤ —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞—á–∏ –¥–æ–ø—É—Å—Ç–∏–º–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ cookie/—Å–µ—Å—Å–∏–∏ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –∏–Ω–æ–µ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ).

### 3.4 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –æ—à–∏–±–∫–∏

- –ï—Å–ª–∏ tenant_id –∏–ª–∏ user_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã –≤ –∑–∞–ø—Ä–æ—Å–µ —á–∞—Ç–∞ –∏–ª–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ ‚Üí –æ—Ç–≤–µ—Ç 400 —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ.
- –ï—Å–ª–∏ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ —á–∞—Ç–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ) ‚Üí –æ—Ç–≤–µ—Ç 400.
- –ï—Å–ª–∏ —Ñ–∞–π–ª –ø—Ä–æ–º–ø—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞ —á–∞—Ç–∞ ‚Üí –æ—Ç–≤–µ—Ç 500 (–∏–ª–∏ –æ—Ç–∫–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏).
- –ï—Å–ª–∏ LLM DeepSeek –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É ‚Üí –æ—Ç–≤–µ—Ç 502 –∏–ª–∏ 503 –∏ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ SSE-–ø–æ—Ç–æ–∫–∞; —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (—Ä–µ—à–µ–Ω–∏–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ/–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏).
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è SSE ‚Üí —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–∑–æ–≤ LLM –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–∂–µ –ø–æ–ª—É—á–µ–Ω–Ω—É—é —á–∞—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –≤ –ë–î –∏–ª–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å ‚Äî –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏–Ω—è—Ç–æ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.
- –î–ª—è –∫–∞–±–∏–Ω–µ—Ç–∞: –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ —á—É–∂–æ–º—É –¥–∏–∞–ª–æ–≥—É –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–º—É (–ø–æ dialog_id/saved_id –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ tenant_id –∏ user_id) ‚Üí –æ—Ç–≤–µ—Ç 404.

---

## 4. –ü—Ä–∞–≤–∏–ª–∞ –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

- –û–¥–∏–Ω HTTP-–∑–∞–ø—Ä–æ—Å —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞ –ø–æ—Ä–æ–∂–¥–∞–µ—Ç —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –≤—ã–∑–æ–≤ LLM –∏ –æ–¥–∏–Ω SSE-–ø–æ—Ç–æ–∫.
- –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ .env.
- –ü—Ä–æ–º–ø—Ç LLM –≤—Å–µ–≥–¥–∞ —á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ —Ñ–∞–π–ª–∞; –ø—É—Ç—å/–∏–º—è —Ñ–∞–π–ª–∞ –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.
- –í –ë–î —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–∏–∞–ª–æ–≥–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ tenant_id –∏ user_id; –∏–∑–æ–ª—è—Ü–∏—è –ø–æ —Ç–µ–Ω–∞–Ω—Ç—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞.
- URL LLM-—Å–µ—Ä–≤–µ—Ä–∞ –≤—Å–µ–≥–¥–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∏–ª–∏ .env).
- –í—Å–µ API-–∑–∞–ø—Ä–æ—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–ª–∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—é—Ç tenant_id; –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö –ø–∞—Ä—ã (tenant_id, user_id).
- –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ –≤—Å–µ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ tenant_id –∏ user_id; –≤–æ–∑–≤—Ä–∞—Ç —á—É–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–µ—â—ë–Ω.

---

## 5. –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### 5.1 DTO / API –º–æ–¥–µ–ª–∏

**–ß–∞—Ç:**
- –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (POST): —Ç–µ–ª–æ JSON ‚Äî tenant_id (—Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ UUID), user_id (—Å—Ç—Ä–æ–∫–∞), message (—Å—Ç—Ä–æ–∫–∞). –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: dialog_id (—Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ UUID) –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞.
- –û—Ç–≤–µ—Ç SSE: –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ Server-Sent Events; –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ ‚Äî —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞ LLM (–ø–æ–ª–µ data —Å —Å—Ç—Ä–æ–∫–æ–π). –û–¥–Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å –ø—Ä–∏–∑–Ω–∞–∫–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (—Ñ–æ—Ä–º–∞—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–µ–Ω –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏).
- –û—Ç–≤–µ—Ç –æ–± –æ—à–∏–±–∫–µ: JSON —Å –ø–æ–ª–µ–º detail –∏ HTTP-–∫–æ–¥ 4xx/5xx.

**–ö–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
- GET —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤: query –∏–ª–∏ path ‚Äî tenant_id; user_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (X-User-Id) –∏–ª–∏ —Å–µ—Å—Å–∏–∏/cookie. –û—Ç–≤–µ—Ç: JSON ‚Äî —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ { id, created_at, updated_at, preview (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) }; –ø–∞–≥–∏–Ω–∞—Ü–∏—è ‚Äî limit, offset –≤ query; –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è total (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –∏ items.
- GET –æ–¥–∏–Ω –¥–∏–∞–ª–æ–≥: path ‚Äî tenant_id, dialog_id; user_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Å–µ—Å—Å–∏–∏. –û—Ç–≤–µ—Ç: JSON ‚Äî —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π { role, content, created_at }.
- GET —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ: path ‚Äî tenant_id; user_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Å–µ—Å—Å–∏–∏. –û—Ç–≤–µ—Ç: JSON ‚Äî —Å–ø–∏—Å–æ–∫ { id, type, reference_id, created_at }; –ø–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é.
- POST —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ: path ‚Äî tenant_id; —Ç–µ–ª–æ ‚Äî type, reference_id; user_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Å–µ—Å—Å–∏–∏. –û—Ç–≤–µ—Ç: 201 –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç { id, type, reference_id, created_at }.
- DELETE —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ: path ‚Äî tenant_id, id —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ; user_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Å–µ—Å—Å–∏–∏. –û—Ç–≤–µ—Ç: 204 –∏–ª–∏ 404.
- GET –ø—Ä–æ—Ñ–∏–ª—å: path ‚Äî tenant_id; user_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Å–µ—Å—Å–∏–∏. –û—Ç–≤–µ—Ç: JSON ‚Äî { user_id, display_name, contact (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) }.
- PATCH –ø—Ä–æ—Ñ–∏–ª—å: path ‚Äî tenant_id; —Ç–µ–ª–æ ‚Äî display_name, contact (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ); user_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Å–µ—Å—Å–∏–∏. –û—Ç–≤–µ—Ç: 200 –∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø—Ä–æ—Ñ–∏–ª—è.

–ï–¥–∏–Ω—ã–π —Ç–∏–ø tenant_id –∏ user_id –≤ —Ä–∞–º–∫–∞—Ö API (—Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ UUID) —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏; –∫–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8, –¥–∞—Ç—ã/–≤—Ä–µ–º—è ‚Äî ISO 8601 –∏–ª–∏ Unix timestamp –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ.

### 5.2 –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

- –¢–µ–Ω–∞–Ω—Ç: id (tenant_id), slug (–¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤), name, created_at; –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (JSON –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è) ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –î–∏–∞–ª–æ–≥: id (dialog_id), tenant_id, user_id, created_at, updated_at.
- –°–æ–æ–±—â–µ–Ω–∏–µ: id, tenant_id, user_id, dialog_id, role (user | assistant), content (—Ç–µ–∫—Å—Ç), created_at.
- –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ: id, tenant_id, user_id, type (—Å—Ç—Ä–æ–∫–∞), reference_id (—Å—Ç—Ä–æ–∫–∞), created_at.
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–Ω–∞–Ω—Ç–∞): tenant_id, user_id, display_name (—Å—Ç—Ä–æ–∫–∞, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), contact (—Å—Ç—Ä–æ–∫–∞, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), updated_at ‚Äî –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –ø–∞—Ä—É (tenant_id, user_id).

–°—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü –ë–î (–∏–º–µ–Ω–∞ –ø–æ–ª–µ–π –∏ —Ç–∏–ø—ã) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–æ–¥–µ –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è—Ö.

---

## 6. –ü–µ—Ä—Å–∏—Å—Ç–∞–Ω—Å –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- –•—Ä–∞–Ω–∏–ª–∏—â–µ: PostgreSQL. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env: —Ö–æ—Å—Ç, –ø–æ—Ä—Ç, –∏–º—è –ë–î, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–∞—Ä–æ–ª—å.
- –¢–∞–±–ª–∏—Ü—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã: tenant (id, slug, name, created_at; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ settings); dialog (id, tenant_id, user_id, created_at, updated_at); message (id, tenant_id, user_id, dialog_id, role, content, created_at); saved_item (id, tenant_id, user_id, type, reference_id, created_at); user_profile (tenant_id, user_id, display_name, contact, updated_at) ‚Äî –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (tenant_id, user_id). –ò–Ω–¥–µ–∫—Å—ã: –ø–æ (tenant_id, user_id) –¥–ª—è dialog, message, saved_item, user_profile; –ø–æ (tenant_id, user_id, updated_at) –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤.
- –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö: —Ç–∏–ø—ã PostgreSQL (uuid, text, varchar, bigint, timestamp –∏ —Ç.–¥.) –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π.
- –ú–∞–ø–ø–∏–Ω–≥ / –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º: —á–µ—Ä–µ–∑ ORM (SQLAlchemy, Tortoise –∏ —Ç.–¥.) –∏–ª–∏ —Å—ã—Ä–æ–π SQL; –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç—É–ø–∞ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞.
- –ú–∏–≥—Ä–∞—Ü–∏–∏: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (Alembic –∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ; —Å—Ö–µ–º–∞ –ë–î –Ω–µ –¥–æ–ª–∂–Ω–∞ –º–µ–Ω—è—Ç—å—Å—è –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏.

---

## 7. –ì—Ä–∞–Ω–∏—Ü—ã –∑–∞–¥–∞—á–∏ (Out of scope)

–Ø–≤–Ω–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω–æ–≥–æ –¢–ó:

- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–±–∏–Ω–µ—Ç–∞ —Ç–µ–Ω–∞–Ω—Ç–∞ (dashboard –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏–Ω—Å—Ç–∞–Ω—Å–∞), –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ —Ç–µ–Ω–∞–Ω—Ç–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π (tenant_member), –±–∏–ª–ª–∏–Ω–≥.
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (—á–∞—Ç –≤ iframe –∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ docker-compose.
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–Ω–µ .env.
- –•–∞—Ä–¥–∫–æ–¥ –ø—Ä–æ–º–ø—Ç–∞ LLM –≤ –∫–æ–¥–µ –∏–ª–∏ URL LLM –≤–Ω–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ WebSocket, –æ—á–µ—Ä–µ–¥–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¢–ó.
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π (–æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å ¬´—É—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å¬ª); –≤ scope –≤—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ user_id –∏–∑ cookie/—Å–µ—Å—Å–∏–∏ (–∞–Ω–æ–Ω–∏–º–Ω—ã–π –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç–æ–º).

---

## 8. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 8.1 –ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å

#### –î–æ–±–∞–≤–∏—Ç—å

- FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –º–∞—Ä—à—Ä—É—Ç–æ–º POST –¥–ª—è –ø—Ä–∏—ë–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (tenant_id, user_id, message; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ dialog_id).
- –≠–Ω–¥–ø–æ–∏–Ω—Ç –∏–ª–∏ –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–¥–∞—á–∏ SSE-–ø–æ—Ç–æ–∫–∞ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è (—Å—Ç—Ä–∏–º –æ—Ç–≤–µ—Ç–∞ LLM).
- –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env (–≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ë–î, URL LLM, –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –ø—Ä–æ–º–ø—Ç–∞).
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ LLM –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–ø—É—Ç—å/–∏–º—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏).
- HTTP-–∫–ª–∏–µ–Ω—Ç –∫ LLM DeepSeek —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞; URL –∏–∑ .env.
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ PostgreSQL —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ tenant_id, user_id –∏ dialog_id.
- API –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: GET/POST/DELETE —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ; GET —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ GET –æ–¥–∏–Ω –¥–∏–∞–ª–æ–≥; GET/PATCH –ø—Ä–æ—Ñ–∏–ª—å. –í—Å–µ —Å —É—á—ë—Ç–æ–º tenant_id –∏ user_id (user_id –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Å–µ—Å—Å–∏–∏/cookie).
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ tenant_slug ‚Üí tenant_id (—Ç–∞–±–ª–∏—Ü–∞ tenant –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è); —Ä–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–∏–ª–∏ SPA) –¥–ª—è –ø—É—Ç–µ–π `/{tenant_slug}/my`, `/{tenant_slug}/my/dialogs`, `/{tenant_slug}/my/saved`, `/{tenant_slug}/my/profile`.
- –†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —á–∞—Ç–∞ –≤ iframe (—Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø—Ä–∏—ë–º SSE); –ø–µ—Ä–µ–¥–∞—á–∞ tenant_id –∏ user_id –Ω–∞ –∫–ª–∏–µ–Ω—Ç (user_id –∏–∑ cookie/—Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ).
- Dockerfile –∏ docker-compose –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ PostgreSQL; –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose.
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (Alembic –∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã (tenant, dialog, message, saved_item, user_profile).

#### –ò–∑–º–µ–Ω–∏—Ç—å

- –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ (–Ω–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è).

#### –£–¥–∞–ª–∏—Ç—å (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

- –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ.

### 8.2 –ß–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å

- –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤–Ω–µ .env.
- –ù–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –ø—Ä–æ–º–ø—Ç LLM –∏ URL LLM –≤ –∫–æ–¥–µ.
- –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –Ω–µ –æ–ø–∏—Å–∞–Ω–Ω—É—é –≤ –¥–∞–Ω–Ω–æ–º –¢–ó (–∫–∞–±–∏–Ω–µ—Ç —Ç–µ–Ω–∞–Ω—Ç–∞, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤, –±–∏–ª–ª–∏–Ω–≥, WebSocket, –æ—á–µ—Ä–µ–¥–∏), –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¢–ó.
- –ù–µ –º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É –ë–î –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π.
- –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤ API –∫–∞–±–∏–Ω–µ—Ç–∞ –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–≥–æ user_id –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ tenant_id.

---

## 9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- –¢–∏–ø —Ç–µ—Å—Ç–æ–≤: unit –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ integration (API —á–∞—Ç–∞, API –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ë–î); –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ LLM (–º–æ–∫ HTTP-–∫–ª–∏–µ–Ω—Ç–∞ –∫ DeepSeek).
- –ì–¥–µ/–∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å: pytest –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –∏–∑ –æ–±—Ä–∞–∑–∞/–æ–∫—Ä—É–∂–µ–Ω–∏—è —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: pytest; –ø—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ ‚Äî pytest-asyncio; –º–æ–∫–∏ –¥–ª—è HTTP-–∫–ª–∏–µ–Ω—Ç–∞ –∫ LLM –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è –ë–î (—Ñ–∏–∫—Å—Ç—É—Ä—ã).
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ LLM –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–∞—Ö –±–µ–∑ —è–≤–Ω–æ–π –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ (e2e); —Ö–∞—Ä–¥–∫–æ–¥ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö.
- –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ: –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (arrange/act/assert).
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM –∏ SSE-–æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ –º–æ–∫–µ LLM; —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –ë–î –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö tenant_id –∏ user_id; –≤–æ–∑–≤—Ä–∞—Ç 4xx/5xx –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ LLM (–º–æ–∫); —á—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env –∏ –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞; API –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–µ–≥–æ user_id, –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–ª–æ–≥–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏, CRUD —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –∏ –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ä–∞–º–∫–∞—Ö tenant_id –∏ user_id; –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤.

---

## 10. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (Definition of Done)

- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 3 (—á–∞—Ç –∏ –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
- –°–æ–±–ª—é–¥–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 1.2.
- –í—Å–µ —Ç–µ—Å—Ç—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 9 –ø—Ä–æ—Ö–æ–¥—è—Ç.
- –í –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–µ—Ç –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö placeholder'–æ–≤.

---

## 11. –ò—Å—Ç–æ—Ä–∏—è —Ä–µ—à–µ–Ω–∏–π (Rationale ‚Äî read‚Äëonly)

> –†–∞–∑–¥–µ–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–º—ã—Å–ª–∞ —Ä–µ—à–µ–Ω–∏–π. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é –∑–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

- –í—ã–±—Ä–∞–Ω –í–∞—Ä–∏–∞–Ω—Ç 2 (REST + SSE): FastAPI, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ REST, —Å—Ç—Ä–∏–º–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ LLM —á–µ—Ä–µ–∑ Server-Sent Events; –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å (tenant_id, user_id). –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ—Å—Ç–æ—Ç–æ–π —Å—Ç–µ–∫–∞ –∏ –ø—Ä–∏–µ–º–ª–µ–º—ã–º UX –±–µ–∑ –æ—á–µ—Ä–µ–¥–µ–π –∏ –≤–æ—Ä–∫–µ—Ä–æ–≤.
- –ö–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –≤—ã–±—Ä–∞–Ω –í–∞—Ä–∏–∞–Ω—Ç B (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç) ‚Äî —Ä–∞–∑–¥–µ–ª—ã ¬´–ú–æ–∏ –¥–∏–∞–ª–æ–≥–∏¬ª, ¬´–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ¬ª, ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª; API –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ–Ω–∞–Ω—Ç–∞; user_id –∏–∑ —Å–µ—Å—Å–∏–∏/cookie (–∞–Ω–æ–Ω–∏–º–Ω—ã–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ).
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: –í–∞—Ä–∏–∞–Ω—Ç 1 (REST –±–µ–∑ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞) –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç –∏–∑-–∑–∞ –ø–ª–æ—Ö–æ–≥–æ UX; –í–∞—Ä–∏–∞–Ω—Ç 3 (WebSocket) –∏ –í–∞—Ä–∏–∞–Ω—Ç 4 (–æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á) ‚Äî –∏–∑–±—ã—Ç–æ—á–Ω—ã –¥–ª—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏. –ö–∞–±–∏–Ω–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —á–∞—Ç (–í–∞—Ä–∏–∞–Ω—Ç A) –Ω–µ –≤—ã–±—Ä–∞–Ω; —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π UI –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ.
- –ö–æ–º–ø—Ä–æ–º–∏—Å—Å: –µ–¥–∏–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è; —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ PostgreSQL –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ç—Ä–∏–º–∞; –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ scope; –∫–∞–±–∏–Ω–µ—Ç —Ç–µ–Ω–∞–Ω—Ç–∞ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ ‚Äî out of scope –≤ –¥–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –¢–ó.
